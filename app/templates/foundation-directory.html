<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foundation Directory - Pink Lemonade</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* Pink Lemonade brand colors - consistent with dashboard */
        :root {
            --pink: #db2777;
            --pink-light: #f9a8d4;
            --pink-dark: #be185d;
            --white: #ffffff;
            --black: #000000;
            --grey-light: #f3f4f6;
            --grey: #6b7280;
            --grey-dark: #374151;
            --border: #e5e7eb;
            --success: #db2777;
            --warning: #f59e0b;
            --danger: #374151;
        }

        body {
            background-color: var(--grey-light);
            color: var(--black);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        .sidebar {
            background-color: var(--white);
            border-right: 1px solid var(--border);
            min-height: 100vh;
            width: 250px;
            transition: all 0.3s ease;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .nav-item {
            padding: 0.75rem 1rem;
            color: var(--grey);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover, .nav-item.active {
            background-color: #f3f4f6;
            color: var(--pink);
        }

        .top-bar {
            background: var(--white);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
        }

        

        .main-content {
            margin-left: 250px;
            padding: 2rem;
        }

        .foundation-card {
            background: var(--white);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .foundation-card:hover {
            transform: translateY(-2px);
            border: 1px solid #e5e7eb;
        }

        .search-container {
            background: var(--white);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e5e7eb;
            border: 1px solid var(--border);
        }

        .filter-input, .filter-select {
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--white);
            color: var(--black);
            transition: all 0.2s ease;
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: var(--pink);
            border: 2px solid #db2777;
        }

        .btn-primary {
            background-color: var(--pink);
            color: var(--white);
            padding: 0.5rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-primary:hover {
            background-color: var(--pink-dark);
        }

        .btn-secondary {
            background-color: var(--grey-light);
            color: var(--grey-dark);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
            cursor: pointer;
        }

        .btn-secondary:hover {
            background-color: var(--grey);
            color: var(--white);
        }

        .focus-tag {
            background-color: #f3f4f6;
            color: var(--pink-dark);
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            display: inline-block;
        }

        .deadline-status {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .deadline-open { background-color: var(--pink); color: var(--white); }
        .deadline-closing { background-color: var(--warning); color: var(--white); }
        .deadline-closed { background-color: var(--grey-dark); color: var(--white); }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 2rem;
            gap: 0.5rem;
        }

        .city-header {
            background: var(--white);
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            margin: 2rem 0 1rem 0;
            border: 1px solid var(--border);
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                z-index: 1000;
                transform: translateX(-100%);
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0 !important;
            }

            .search-container {
                padding: 1rem;
            }

            .foundation-card {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Top Navigation Bar -->
    <div class="top-bar flex items-center justify-between">
        <div class="flex items-center space-x-4">
            <button id="sidebar-toggle" class="md:hidden p-2">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
            
            <h1 class="text-xl font-semibold hidden md:block" style="color: var(--black);">Foundation Directory</h1>
        </div>
        
        <div class="flex items-center space-x-4">
            <a href="/dashboard" class="text-sm hover:underline" style="color: var(--pink);">‚Üê Back to Dashboard</a>
        </div>
    </div>

    <div class="flex">
        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar">
            <nav class="mt-8">
                <div class="nav-item" onclick="window.location.href='/dashboard'">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                        </svg>
                        <span class="nav-text">Dashboard</span>
                    </div>
                </div>
                
                <div class="nav-item active">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                        <span class="nav-text">Foundation Directory</span>
                    </div>
                </div>
                
                <div class="nav-item">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <span class="nav-text">Grants Feed</span>
                    </div>
                </div>
                
                <div class="nav-item">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                        </svg>
                        <span class="nav-text">Saved Opportunities</span>
                    </div>
                </div>
                

                <div class="nav-item">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <span class="nav-text">Settings</span>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Search and Filter Section -->
            <div class="search-container">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium mb-2" style="color: var(--grey-dark);">Search Foundations</label>
                        <input type="text" id="search-input" placeholder="Search by name, description, or focus area..." 
                               class="filter-input w-full" data-search-target="foundations">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2" style="color: var(--grey-dark);">City</label>
                        <select id="city-filter" class="filter-select w-full">
                            <option value="">All Cities</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2" style="color: var(--grey-dark);">Focus Area</label>
                        <select id="focus-filter" class="filter-select w-full">
                            <option value="">All Focus Areas</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex flex-wrap items-center gap-4 mt-4">
                    <div>
                        <label class="block text-sm font-medium mb-2" style="color: var(--grey-dark);">Deadline Status</label>
                        <select id="deadline-filter" class="filter-select">
                            <option value="">All Deadlines</option>
                            <option value="open">Open</option>
                            <option value="closing_soon">Closing Soon</option>
                            <option value="closed">Closed</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="clearFilters()" class="btn-secondary">Clear Filters</button>
                    </div>
                </div>
            </div>

            <!-- Results Count -->
            <div class="mb-4">
                <p class="text-sm" style="color: var(--grey);">
                    Showing <span id="results-count">0</span> foundations
                </p>
            </div>

            <!-- Foundation Listings -->
            <div id="foundations-container">
                <!-- Foundation entries will be populated here -->
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination-container">
                <!-- Pagination will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Foundation Directory JavaScript
        let foundationsData = {};
        let filteredFoundations = [];
        let currentPage = 1;
        const foundationsPerPage = 10;

        // Initialize the foundation directory
        async function initFoundationDirectory() {
            try {
                // Load foundations data - API endpoint placeholder
                /* TODO: Replace with actual API endpoint
                const response = await fetch('/api/foundations');
                foundationsData = await response.json();
                */
                
                // Load from JSON file for now
                const response = await fetch('/static/foundations-data.json');
                foundationsData = await response.json();
                
                populateFilters();
                displayFoundations();
                
            } catch (error) {
                // Error logged: 'Error loading foundation data:', error
                document.getElementById('foundations-container').innerHTML = 
                    '<p class="text-center p-8">Error loading foundation data. Please try again later.</p>';
            }
        }

        // Populate filter dropdowns
        function populateFilters() {
            const cityFilter = document.getElementById('city-filter');
            const focusFilter = document.getElementById('focus-filter');
            
            // Populate city filter
            Object.keys(foundationsData.cities).forEach(cityKey => {
                const city = foundationsData.cities[cityKey];
                const option = document.createElement('option');
                option.value = cityKey;
                option.textContent = city.name;
                cityFilter.appendChild(option);
            });
            
            // Populate focus area filter
            foundationsData.focus_areas.forEach(focusArea => {
                const option = document.createElement('option');
                option.value = focusArea;
                option.textContent = focusArea;
                focusFilter.appendChild(option);
            });
        }

        // Apply filters and search
        function applyFilters() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const cityFilter = document.getElementById('city-filter').value;
            const focusFilter = document.getElementById('focus-filter').value;
            const deadlineFilter = document.getElementById('deadline-filter').value;
            
            filteredFoundations = [];
            
            Object.keys(foundationsData.cities).forEach(cityKey => {
                if (cityFilter && cityFilter !== cityKey) return;
                
                const city = foundationsData.cities[cityKey];
                city.foundations.forEach(foundation => {
                    // Search filter
                    const searchableText = (
                        foundation.name + ' ' + 
                        foundation.description + ' ' + 
                        foundation.focus_areas.join(' ')
                    ).toLowerCase();
                    
                    if (searchTerm && !searchableText.includes(searchTerm)) return;
                    
                    // Focus area filter
                    if (focusFilter && !foundation.focus_areas.includes(focusFilter)) return;
                    
                    // Deadline filter
                    if (deadlineFilter && foundation.deadline_status !== deadlineFilter) return;
                    
                    // Add city information to foundation
                    const foundationWithCity = { ...foundation, city: city.name, cityKey: cityKey };
                    filteredFoundations.push(foundationWithCity);
                });
            });
            
            currentPage = 1;
            displayFoundations();
        }

        // Display foundations with pagination
        function displayFoundations() {
            const container = document.getElementById('foundations-container');
            const startIndex = (currentPage - 1) * foundationsPerPage;
            const endIndex = startIndex + foundationsPerPage;
            const pageFoundations = filteredFoundations.slice(startIndex, endIndex);
            
            // Update results count
            document.getElementById('results-count').textContent = filteredFoundations.length;
            
            if (pageFoundations.length === 0) {
                container.innerHTML = '<p class="text-center p-8" style="color: var(--grey);">No foundations found matching your criteria.</p>';
                document.getElementById('pagination-container').innerHTML = '';
                return;
            }
            
            // Group foundations by city
            const foundationsByCity = {};
            pageFoundations.forEach(foundation => {
                if (!foundationsByCity[foundation.city]) {
                    foundationsByCity[foundation.city] = [];
                }
                foundationsByCity[foundation.city].push(foundation);
            });
            
            let html = '';
            Object.keys(foundationsByCity).forEach(cityName => {
                html += `<div class="city-header">
                    <h2 class="text-lg font-semibold" style="color: var(--black);">${cityName}</h2>
                </div>`;
                
                foundationsByCity[cityName].forEach(foundation => {
                    const deadlineStatusClass = `deadline-${foundation.deadline_status === 'closing_soon' ? 'closing' : foundation.deadline_status}`;
                    const deadlineStatusText = foundation.deadline_status === 'closing_soon' ? 'Closing Soon' : 
                                             foundation.deadline_status === 'open' ? 'Open' : 'Closed';
                    
                    html += `
                        <div class="foundation-card" 
                             data-foundation-id="${foundation.id}"
                             data-name="${foundation.name}"
                             data-description="${foundation.description}"
                             data-focus-areas="${foundation.focus_areas.join(',')}"
                             data-deadline="${foundation.deadline}">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h3 class="text-lg font-semibold mb-1" style="color: var(--black);">${foundation.name}</h3>
                                    <p class="text-sm" style="color: var(--grey);">${foundation.grant_range}</p>
                                </div>
                                <div class="text-right">
                                    <span class="deadline-status ${deadlineStatusClass}">${deadlineStatusText}</span>
                                    <p class="text-sm mt-1" style="color: var(--grey);">Due: ${foundation.deadline}</p>
                                </div>
                            </div>
                            
                            <p class="mb-3" style="color: var(--grey-dark);">${foundation.description}</p>
                            
                            <div class="mb-4">
                                ${foundation.focus_areas.map(area => `<span class="focus-tag">${area}</span>`).join('')}
                            </div>
                            
                            <div class="flex justify-between items-center">
                                <div class="flex space-x-2">
                                    <button class="btn-primary" onclick="viewFoundationDetails('${foundation.id}')">
                                        View Details
                                    </button>
                                    <button class="btn-secondary" onclick="saveToGrants('${foundation.id}')">
                                        Save to My Grants
                                    </button>
                                </div>
                                <a href="mailto:${foundation.contact_email}" class="text-sm hover:underline" style="color: var(--pink);">
                                    Contact Foundation
                                </a>
                            </div>
                        </div>
                    `;
                });
            });
            
            container.innerHTML = html;
            updatePagination();
        }

        // Update pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredFoundations.length / foundationsPerPage);
            const container = document.getElementById('pagination-container');
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // Previous button
            if (currentPage > 1) {
                html += `<button class="btn-secondary" onclick="changePage(${currentPage - 1})">Previous</button>`;
            }
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    html += `<button class="btn-primary">${i}</button>`;
                } else {
                    html += `<button class="btn-secondary" onclick="changePage(${i})">${i}</button>`;
                }
            }
            
            // Next button
            if (currentPage < totalPages) {
                html += `<button class="btn-secondary" onclick="changePage(${currentPage + 1})">Next</button>`;
            }
            
            container.innerHTML = html;
        }

        // Change page
        function changePage(page) {
            currentPage = page;
            displayFoundations();
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('city-filter').value = '';
            document.getElementById('focus-filter').value = '';
            document.getElementById('deadline-filter').value = '';
            applyFilters();
        }

        // Placeholder functions for interactions
        function viewFoundationDetails(foundationId) {
            // TODO: Implement foundation details modal or navigation
            alert(`View details for foundation: ${foundationId}`);
        }

        function saveToGrants(foundationId) {
            // TODO: Implement save to grants functionality
            alert(`Saved foundation ${foundationId} to your grants list`);
        }

        // Event listeners
        document.getElementById('search-input').addEventListener('input', applyFilters);
        document.getElementById('city-filter').addEventListener('change', applyFilters);
        document.getElementById('focus-filter').addEventListener('change', applyFilters);
        document.getElementById('deadline-filter').addEventListener('change', applyFilters);

        // Sidebar toggle for mobile
        document.getElementById('sidebar-toggle').addEventListener('click', () => {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-open');
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initFoundationDirectory);
    </script>
</body>
</html>